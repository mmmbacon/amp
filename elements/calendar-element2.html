<!DOCTYPE html>
<html lang="">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <link rel="import" href="../bower_components/polymer/polymer.html">
    <link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
    <link rel="import" href="../bower_components/paper-material/paper-material.html">
    <link rel="import" href="../bower_components/iron-icons/iron-icons.html">
    <link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
    
    <script src="../bower_components/moment/moment.js"></script>
</head>

<body>
    <dom-module id="calendar-element2">
        <template>
            <style is="custom-style" include="iron-flex iron-flex-alignment">
                
                @import url(https://fonts.googleapis.com/css?family=Hind);
                
                @keyframes transition {
                    0% {
                        background-color: cadetblue;
                    }
                    100% {
                        background-color: #226D70;
                    }
                }
                @keyframes rectangletocircle {
                    0% {
                        border-radius:0px;
                    }
                    100% {
                        border-radius:20px;
                    }
                }

                .dayBox {
                    color: white;
                    width: 41.75px;
                    height: 40px;
                    line-height:40px;
                    font: "Arial";
                    margin:0px;
                    /*border:1px solid black;*/ 
                }
                .dayBoxCollection {
                    color: white;
                    background-color: #226D70;
                    width: 294px;
                    height: 40px;
                    line-height:40px;
                    font: "Arial";
                    margin:1px;
                    margin-bottom: 5px;
                }
                .dateBox {
                    background-color: cadetblue;
                    width: 40px;
                    height: 40px;
                    line-height:40px;
                    margin:1px;
                }
                .dateBox.light1{
                    background-color: #93C5C7;
                    width: 40px;
                    height: 40px;
                    line-height:40px;
                    margin:1px;
                }
                .dateBox.light2{
                    background-color: #C9E4E7;
                    width: 40px;
                    height: 40px;
                    line-height:40px;
                    margin:1px;
                }
                .dateBox.dark{
                    background-color: cadetblue;
                    width: 40px;
                    height: 40px;
                    line-height:40px;
                    margin:1px;
                }
                .dateBox:hover{
                    animation-name: transition;
                    animation-duration: 0.2s;
                    background-color: #226D70;
                    cursor: pointer;
                }
                .dateBox:active{
                    animation-name: rectangletocircle;
                    animation-duration: 0.05s;
                    border-radius: 20px;
                    background-color: #226D70;
                }
                
                .boundingbox{
                    /*display: inline-block;*/
                    width:294px;
                    padding:5px;
                }
                
                .outerbox {
                    /*display: inline-block;*/
                    padding:5px;
                    width:300px;
                    /*border: 1px solid black;*/
                }
                
                .heading {
                    color: white;
                    background-color: #226D70;
                    height: 40px;
                    line-height: 40px;
                    width: 292px;
                    margin:0px;
                }
                .datechange:hover {
                    cursor: pointer;
                    color: beige;
                }
                .detailBox.default {
                    display: none;
                    background-color: cadetblue;
                    margin:1px;
                    margin-top:5px;
                    width: 292px;
                    padding: 7px;
                }
                .detailBox.closed {
                    visibility: hidden;
                    max-height: 0px;
                    transition: max-height 1s cubic-bezier(.4,.86,.07,.99);
                    color: white;
                    background-color: cadetblue;
                    margin:1px;
                    margin-top:5px;
                    width: 292px;
                    padding: 7px;
                }
                .detailBox.open {
                    visibility: visible;
                    max-height: 220px;
                    overflow: hidden;
                    transition: max-height 1s cubic-bezier(.4,.86,.07,.99);
                    color: white;
                    background-color: cadetblue;
                    visibility: visible;
                    margin:1px;
                    margin-top:5px;
                    width: 292px;
                    padding: 7px;
                }
                
            </style>
            
            <paper-material class$="outerbox {{outerboxState}} layout vertical center" id="outerbox">
                <div class="layout horizontal center-justified">
                    <paper-material class="heading layout horizontal">
                        <paper-icon-button id="decrease" class="datechange layout horizontal end-justified" on-tap="decreaseMonth" icon="arrow-back"><&nbsp</paper-icon-button>
                        <span class="flex"><div class="layout horizontal center-justified">{{currentMonth}}&nbsp;{{currentYear}}</div></span>
                        <paper-icon-button id="increase" class="datechange layout horizontal end-justified" on-tap="increaseMonth" icon="arrow-forward">&nbsp></paper-icon-button>
                    </paper-material>
                </div>
                <div class="boundingbox layout horizontal wrap" id="boundingBox">
                     <paper-material class="dayBoxCollection layout horizontal">
                        <template is="dom-repeat" items="{{dayOfWeekArray}}">
                            <div class="dayBox layout vertical center">
                                {{item.day}}
                            </div>
                        </template>
                    </paper-material> 
                    <template is="dom-repeat" items="{{dateArray}}">
                        <paper-material class$="dateBox {{item.color}} layout vertical center" id="{{item.position}}" on-tap="dateSelected" title="{{item.dateShort}}">
                           {{item.dateText}}
                        </paper-material>
                    </template>
                    <paper-material class$="detailBox {{detailState}}">
                        <b>{{currentSelectedDate}}</b>
                        <p>Item 1</p>
                        <p>Item 1</p>

                    </paper-material>
                </div>
            </paper-material>
        </template>
        <script>
            
            Polymer({
                is : 'calendar-element2',
                ready : function(){
                    this.init();
                    this.setDate();
                    this.currentSelectedDate;
                    //Init Calendar
                    this.createCalendar();
                    this.detailState = "closed";
                },
                init : function(){
                    this.moment = moment();
                },
                decreaseMonth : function(e){
                    this.moment.subtract(1,'month');
                    this.setDate();
                    this.createCalendar();
                    this.hideDetails();
                },
                increaseMonth : function(e){
                    this.moment.add(1,'month');
                    this.setDate();
                    this.createCalendar();
                    this.hideDetails();
                },
                dateSelected : function (e){
                    this.firstDayOfMonth = moment().year(this.moment.year()).month(this.moment.month()).date(1).day();
                    var position = parseInt(e.srcElement.id);
                    var info = this.dateArray[position];
                    this.currentSelectedDate = info.dateShort; // This is where we will query the database with an AJAX request in the future
                    this.showDetails();
                },
                showDetails : function(){
                        this.detailState = "open";
                },
                hideDetails : function(){
                        this.detailState = "closed";
                },
                createCalendar : function (){
                    this.firstDayOfMonth = moment().year(this.moment.year()).month(this.moment.month()).date(1).day();
                    this.dayOfWeekArray = [];
                    this.dateArray = [];
                    
                    //Build Graphical Days of week
                    var day = [
                        moment().day(0).format('ddd'),
                        moment().day(1).format('ddd'),
                        moment().day(2).format('ddd'),
                        moment().day(3).format('ddd'),
                        moment().day(4).format('ddd'),
                        moment().day(5).format('ddd'),
                        moment().day(6).format('ddd')
                    ];
                    for(var x=0;x<day.length;x++){
                        this.push('dayOfWeekArray',{day:day[x]});
                    }
                    
                    //Build Graphical Calendar
                    var position = 0;
                    var difference;
                    var date;
                    
                    //Build Graphical Dates
                    for(var y=0;y<6;y++){
                        for(var x=0;x<7;x++){
                            
                            difference = this.firstDayOfMonth - position;
                            date = moment().year(this.moment.year()).month(this.moment.month()).date(1).subtract(difference, 'days');
                            
                            if(this.firstDayOfMonth == position){
                                if(date.month() != this.moment.month()){
                                    this.push('dateArray',{
                                        dateLong : date,
                                        dateShort : date.format("MMMM D YYYY"),
                                        dateText: moment().year(this.moment.year()).month(this.moment.month()).date(1).format('D'),
                                        color : "light1",
                                        position : position
                                    });
                                }else if(date.day() == 0 ){
                                    this.push('dateArray',{
                                        dateLong : date,
                                        dateShort : date.format("MMMM D YYYY"),
                                        dateText: moment().year(this.moment.year()).month(this.moment.month()).date(1).format('D'),
                                        color : "light2",
                                        position : position
                                    });
                                }else if(date.day() == 6 ){
                                    this.push('dateArray',{
                                        dateLong : date,
                                        dateShort : date.format("MMMM D YYYY"),
                                        dateText: moment().year(this.moment.year()).month(this.moment.month()).date(1).format('D'),
                                        color : "light2",
                                        position : position
                                    });
                                }else{
                                    this.push('dateArray',{
                                        dateLong : date,
                                        dateShort : date.format("MMMM D YYYY"),
                                        dateText: moment().year(this.moment.year()).month(this.moment.month()).date(1).format('D'),
                                        color : "dark",
                                        position : position
                                    });
                                }
                            }else{
                                if(date.month() != this.moment.month()){
                                    this.push('dateArray',{
                                        dateLong : date,
                                        dateShort : date.format("MMMM D YYYY"),
                                        dateText: date.format('D'),
                                        color : "light1",
                                        position : position
                                    });
                                }else if(date.day() == 0){
                                    this.push('dateArray',{
                                        dateLong : date,
                                        dateShort : date.format("MMMM D YYYY"),
                                        dateText: date.format('D'),
                                        color : "light2",
                                        position : position
                                    });
                                }else if(date.day() == 6){
                                    this.push('dateArray',{
                                        dateLong : date,
                                        dateShort : date.format("MMMM D YYYY"),
                                        dateText: date.format('D'),
                                        color : "light2",
                                        position : position
                                    });
                                }else{
                                    this.push('dateArray',{
                                        dateLong : date,
                                        dateShort : date.format("MMMM D YYYY"),
                                        dateText: date.format('D'),
                                        color : "dark",
                                        position : position
                                    });
                                }
                            }
                            position++;
                        }
                    }
                },
                setDate : function(){
                    this.currentYear = moment().year(this.moment.year()).format("YYYY");
                    this.currentMonth = moment().month(this.moment.month()).format("MMMM").toUpperCase();
                    this.currentDate = moment().date(this.moment.date()).format("DDDD");
                    this.currentDay = moment().day(this.moment.day()).format("ddd");
                }
            });
        </script>
    </dom-module>
</body>
</html>
